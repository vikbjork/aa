<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Gratis n√§ra mig</title>
<style>
  body { font-family: Arial, sans-serif; margin:0; background:#111; color:#eee; }
  header { display:flex; align-items:center; padding:10px; background:#222; }
  h1 { flex:1; font-size:18px; }
  button, input { padding:8px; margin:5px; border:none; border-radius:5px; }
  button { background:#0af; color:#fff; cursor:pointer; }
  input { flex:1; }
  #status { padding:10px; font-size:14px; }
  #results { padding:10px; }
</style>
</head>
<body>

<header>
  <h1>üìç Gratis n√§ra mig</h1>
  <button id="gpsBtn">Min plats</button>
</header>

<div id="status">F√∂rs√∂ker hitta plats‚Ä¶</div>
<div id="manualSearch" style="display:none; padding:10px;">
  <input type="text" id="cityInput" placeholder="Skriv stad..." />
  <button id="cityBtn">S√∂k</button>
</div>

<div id="results"></div>

<script>
let userPos = null;

async function getByCity(city){
  document.getElementById('status').textContent = `S√∂ker plats f√∂r "${city}"‚Ä¶`;
  try {
    const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(city)}`);
    const data = await res.json();
    if(data.length > 0){
      userPos = { lat: parseFloat(data[0].lat), lng: parseFloat(data[0].lon) };
      document.getElementById('status').textContent = `Plats satt till: ${city}`;
      loadResults();
    } else {
      document.getElementById('status').textContent = "Hittade ingen plats.";
    }
  } catch(e){
    document.getElementById('status').textContent = "Fel vid s√∂kning.";
  }
}

function tryGPS(){
  document.getElementById('status').textContent = 'F√∂rs√∂ker h√§mta GPS‚Ä¶';
  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(
      pos=>{
        userPos = { lat: pos.coords.latitude, lng: pos.coords.longitude };
        document.getElementById('status').textContent = `GPS hittad (${userPos.lat.toFixed(4)}, ${userPos.lng.toFixed(4)})`;
        loadResults();
      },
      err=>{
        document.getElementById('status').textContent = 'GPS misslyckades ‚Äì skriv stad nedan.';
        document.getElementById('manualSearch').style.display = 'block';
      },
      { enableHighAccuracy:true, timeout:8000 }
    );
  } else {
    document.getElementById('status').textContent = 'Din webbl√§sare st√∂der inte GPS ‚Äì skriv stad nedan.';
    document.getElementById('manualSearch').style.display = 'block';
  }
}

function loadResults(){
  // H√§r h√§mtar du riktiga resultat ‚Äì just nu mock-data
  document.getElementById('results').innerHTML = `
    <p>Visar gratisannonser n√§ra (${userPos.lat.toFixed(4)}, ${userPos.lng.toFixed(4)})‚Ä¶</p>
    <ul>
      <li>Exempel: Soffa bortsk√§nkes</li>
      <li>Exempel: Cykel gratis</li>
    </ul>
  `;
}

document.getElementById('gpsBtn').addEventListener('click', tryGPS);
document.getElementById('cityBtn').addEventListener('click', ()=>getByCity(document.getElementById('cityInput').value));

tryGPS(); // F√∂rs√∂k direkt vid start
</script>

</body>
</html>
